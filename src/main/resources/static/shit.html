<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>试卷展示</title>
</head>
<body>
<div id="app">
    <form action="#" v-on:submit.prevent="sub()">
        <table border="1">
            <tr>
                <th>简答题</th>
                <th>分数</th>
            </tr>
            <tr v-for="(v,k) in answer">
                <td>{{k}}<br>{{v}}</td>

                <td><input type="text"></td>
            </tr>
        </table>
        <button v-on:click="btn()">下一个</button>
        <input type="submit" value="提交">
    </form>

</div>
<script type="text/javascript" src="js/jquery-1.12.2.min.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript">

    var vue = new Vue({
        el : "#app", // 针对指定标签使用vue的语法
        data: {  // 定义的数据
            arr : [],
            answer : "",
            index : 0,
            flag:false
        },
        methods:{
            btn:function(){
                var _this = this;
                if (this.flag) {
                    $.ajax({
                        type: "get",
                        url: "judge/toUpdatePage.do?sid=" + _this.arr[_this.index],
                        dataType: "json",
                        success: function (data) {
                            if (data.code == 0) {
                                if (parseInt(index) < arr.length) {
                                    _this.index++;
                                    _this.answer = data.answer;
                                    _this.flag = false;
                                } else {
                                    alert("后面没有试卷！");
                                }
                            } else {
                                _this.btn();
                                _this.index++;
                            }
                        }
                    })
                } else {
                    alert("请先提交改卷结果！");
                }
            },
            sub:function(){
                var _this = this;
                var score = 0;
                var arr = $("input");
                for(var i in arr) {
                    if (isNaN($("input")[i].val())) {
                        score += parseInt($("input")[i].val());
                    } else {
                        alert("请输入数字");
                    }
                }
                $.ajax({
                    type:"post",
                    url:"subScore/subm.do" + window.location.search,
                    data:{"score":score},
                    dataType:"json",
                    success:function(data){
                        if(data.code == 1){
                            alert("提交成功！");
                            _this.flag = true;
                        }else{
                            alert(data.info);
                        }
                    }
                })
            }


        },
        created:function(){
            _this = this;
            $.ajax({
                type:"post",
                url:"shit" + window.location.search,
                dataType:"json",
                success:function(data) {
                    _this.answer = data;
                }
            }),

            $.ajax({
                type:"get",
                url:"judge/sidArray.do" + window.location.search,
                dataType:"json",
                success:function(data) {
                    _this.arr = data;
                }
            })
        }
    })

</script>
</body>
</html>